<div id="outer-container">
  <div id="container">
    <div id="creator-container">
      <form [formGroup]="invoiceForm">
        <div id="form-title">
          <mat-form-field appearance="standard">
            <input matInput placeholder="Nazwa formularza" formControlName="Form_Title" />
          </mat-form-field>
        </div>
        <div id="questions-container" formArrayName="QuestionData">
          <!-- appSortableList  (sort)="sort(invoiceForm.controls['QuestionData'].controls , $event)" -->
          <div *ngFor="let question of invoiceForm.controls['QuestionData'].controls; let i = index" [formGroupName]="i"
            class="question-field">
            <!-- appSortable -->

            <!-- <div class="grip-container" appGrippable>
              <fa-icon class="grip" [icon]="['fas','grip-horizontal']" ></fa-icon>
            </div> -->
            <div class="question">

              <div class="select-container">
                <mat-form-field appearance="standard">
                  <input matInput placeholder="Pytanie" formControlName="question" />
                </mat-form-field>
                <mat-form-field appearance="standard">
                  <mat-select placeholder="typ kontrolki" formControlName="select" name="control">
                    <div *ngFor="let group of selects">
                      <mat-option *ngFor="let control of group.control" [value]="control.value" (click)="changeControl(question, i)"
                        (focus)="saveLastSelect(question.controls.lastSelect, question.value.select)">
                        {{control.viewValue}}
                      </mat-option>
                      <div class="break"></div>
                    </div>
                  </mat-select>
                </mat-form-field>
              </div>

              <div id="field-data" formArrayName="FieldData" [ngSwitch]="question.value.select">
                <div class="field-loop" *ngFor="let field of question.controls.FieldData.controls; let j = index"
                  [formGroupName]="j">

                  <div class="choice answer" *ngSwitchCase="'short-answer'">
                    <mat-form-field appearance="standard">
                      <input matInput type="text" formControlName="input" placeholder="Twoja odpowiedź">
                    </mat-form-field>
                  </div>

                  <div class="choice answer" *ngSwitchCase="'long-answer'">
                    <mat-form-field appearance="standard">
                      <textarea matInput [rows]="1" type="text" formControlName="input" placeholder="Twoja odpowiedź"
                        matTextareaAutosize></textarea>
                    </mat-form-field>
                  </div>

                  <div class="dropdown" *ngSwitchCase="'dropdown-menu'" formArrayName="choiceOptions">
                    <div *ngFor="let input of field.controls.choiceOptions.controls; let k = index" [formGroupName]="k">
                      <mat-form-field appearance="standard">
                        <input matInput type="text" formControlName="viewValue" maxlength="20" #inputs>
                      </mat-form-field>
                      <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(j, field.controls.choiceOptions)"
                        *ngIf="field.controls.choiceOptions.controls.length > 1"></fa-icon>
                    </div>
                  </div>

                  <div class="linear-scale" *ngSwitchCase="'linear-scale'">
                    <div id="scale-container" class="cont">
                      <mat-form-field appearance="standard">
                        <mat-select placeholder="typ kontrolki" formControlName="minValue" name="control">
                          <mat-option *ngFor="let control of minValue" [value]="control.value">
                            {{control.value}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                      <mat-form-field appearance="standard">
                        <mat-select placeholder="typ kontrolki" formControlName="maxValue" name="control">
                          <mat-option *ngFor="let control of maxValue" [value]="control.value">
                            {{control.value}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div id="label-container" class="cont">
                      <mat-form-field appearance="standard">
                        <input matInput type="text" formControlName="minLabel" placeholder="Etykieta (opcjonalna)"
                          maxlength="30">
                      </mat-form-field>
                      <mat-form-field appearance="standard">
                        <input matInput type="text" formControlName="maxLabel" placeholder="Etykieta (opcjonalna)"
                          maxlength="30">
                      </mat-form-field>
                    </div>
                  </div>

                  <div class="choice" *ngSwitchCase="'single-choice'" formArrayName="choiceOptions">
                    <div *ngFor="let input of field.controls.choiceOptions.controls; let k = index" [formGroupName]="k">
                      <mat-radio-group formControlName="value" name="radio">
                        <mat-radio-button></mat-radio-button>
                      </mat-radio-group>
                      <mat-form-field appearance="standard">
                        <input matInput type="text" formControlName="viewValue" maxlength="20" #inputs>
                      </mat-form-field>
                      <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(j, field.controls.choiceOptions)"
                        *ngIf="field.controls.choiceOptions.controls.length > 1"></fa-icon>
                    </div>
                  </div>

                  <div class="choice" *ngSwitchCase="'multiple-choice'" formArrayName="choiceOptions">
                    <div *ngFor="let input of field.controls.choiceOptions.controls; let k = index" [formGroupName]="k">
                      <div class="checkbox" name="check">
                        <div class="right">
                          <mat-checkbox formControlName="value"></mat-checkbox>
                        </div>
                        <mat-form-field appearance="standard">
                          <input matInput type="text" formControlName="viewValue" maxlength="20" #inputs>
                        </mat-form-field>
                        <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(j, field.controls.choiceOptions)"
                          *ngIf="field.controls.choiceOptions.controls.length > 1"></fa-icon>
                      </div>
                    </div>
                  </div>

                  <div class="form" *ngSwitchCase="'single-grid'">
                    <div id="row-container" class="cont" formArrayName="rows">
                      <div *ngFor="let input of field.controls['rows'].controls; let k = index" [formGroupName]="k">
                        <mat-form-field appearance="standard">
                          <input matInput type="text" formControlName="input" placeholder="Twoja odpowiedź" #inputs2>
                        </mat-form-field>
                        <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(k, field.controls['rows'])"
                          *ngIf="field.controls['rows'].controls.length > 1"></fa-icon>
                      </div>
                      <mat-form-field appearance="standard">
                        <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addInputOption(field.controls['rows'], 'wiersz')"
                          maxlength="0" autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję">
                      </mat-form-field>
                    </div>
                    <div id="column-container" class="cont" formArrayName="columns">
                      <div *ngFor="let radio of field.controls['columns'].controls; let l = index" [formGroupName]="l">
                        <mat-radio-group formControlName="value" name="radio">
                          <mat-radio-button></mat-radio-button>
                        </mat-radio-group>
                        <mat-form-field appearance="standard">
                          <input matInput type="text" [value]="radio.value.viewValue" formControlName="viewValue"
                            maxlength="20" #inputs>
                        </mat-form-field>
                        <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(l, field.controls['columns'])"
                          *ngIf="field.controls['columns'].controls.length > 1"></fa-icon>
                      </div>
                      <mat-form-field class="standalone" appearance="standard">
                        <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addCheckField(field.controls['columns'], 'kolumna')"
                          maxlength="0" autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję">
                      </mat-form-field>
                    </div>
                  </div>

                  <div class="form" *ngSwitchCase="'multiple-grid'">
                    <div id="row-container" class="cont" formArrayName="rows">
                      <div *ngFor="let input of field.controls['rows'].controls; let k = index" [formGroupName]="k">
                        <mat-form-field appearance="standard">
                          <input matInput type="text" formControlName="input" placeholder="Twoja odpowiedź" #inputs2>
                        </mat-form-field>
                        <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(k, field.controls['rows'])"
                          *ngIf="field.controls['rows'].controls.length > 1"></fa-icon>
                      </div>
                      <mat-form-field appearance="standard">
                        <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addInputOption(field.controls['rows'], 'wiersz')"
                          maxlength="0" autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję">
                      </mat-form-field>
                    </div>
                    <div id="column-container" class="cont" formArrayName="columns">
                      <div class="loop" *ngFor="let check of field.controls['columns'].controls; let l = index"
                        [formGroupName]="l">
                        <div class="checkbox">
                          <div class="right">
                            <mat-checkbox formControlName="value"></mat-checkbox>
                          </div>
                          <mat-form-field appearance="standard">
                            <input matInput type="text" [value]="check.value.viewValue" formControlName="viewValue"
                              maxlength="20" #inputs>
                          </mat-form-field>
                          <fa-icon class="delete" [icon]="['fas','times']" (click)="removeField(l, field.controls['columns'])"
                            *ngIf="field.controls['columns'].controls.length > 1"></fa-icon>
                        </div>
                      </div>
                      <mat-form-field class="standalone" appearance="standard">
                        <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addCheckField(field.controls['columns'], 'kolumna')"
                          maxlength="0" autocomplete="off" autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję">
                      </mat-form-field>
                    </div>
                  </div>

                  <div *ngSwitchCase="'dropdown-menu'" class="add">
                    <mat-form-field appearance="standard">
                      <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addCheckField(field.controls.choiceOptions, 'opcja')"
                        autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję" maxlength="0">
                    </mat-form-field>
                  </div>
                  <div *ngSwitchCase="'single-choice'" class="add">
                    <mat-form-field appearance="standard">
                      <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addCheckField(field.controls.choiceOptions, 'opcja')"
                        autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję" maxlength="0">
                    </mat-form-field>
                  </div>
                  <div *ngSwitchCase="'multiple-choice'" class="add">
                    <mat-form-field appearance="standard">
                      <input matInput ngModel [ngModelOptions]="{standalone: true}" (focus)="addCheckField(field.controls.choiceOptions, 'opcja')"
                        autocomplete="off" tabindex="0" role="button" placeholder="Dodaj opcję" maxlength="0">
                    </mat-form-field>
                  </div>
                </div>




              </div>

              <div class="break"></div>
              <div class="menu-container">
                <div class="add">
                  <fa-icon [icon]="['fas','plus']" (click)="addQuestion(i)" matTooltip="{{info.add}}"
                    matTooltipPosition="below"></fa-icon>
                </div>
                <div class="menu">
                  <fa-icon [icon]="['fas','copy']" matTooltip="{{info.copy}}" matTooltipPosition="below" (click)="copyQuestion(question)"></fa-icon>
                  <fa-icon [icon]="['fas','trash']" (click)="removeQuestion(i, question.value.select)" matTooltip="{{info.delete}}"
                    matTooltipPosition="below"></fa-icon>
                </div>
              </div>
            </div>
            <!-- <div class="box"  *appDraggableHelper>coś</div> -->
          </div>
        </div>
        <pre>{{invoiceForm.value | json }}</pre>
      </form>
    </div>
  </div>
</div>
